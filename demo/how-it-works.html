<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Position observer | How javascript position observer works.</title>
    <meta name="description" content="Position observer uses four instances of IntersectionObserver to detect element's position change.">
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/work-visualization.css">
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
  </head>
  <body>
    <header class="header">
      <span class="logo"></span><h1>Position observer</h1>
      <nav class="nav">
        <ul class="nav-links">
          <li class="nav-link"><a href="index.html">Demo</a></li>
          <li class="nav-link current"><a href="how-it-works.html">How it works</a></li>
          <li class="nav-link"><a href="performance.html">Performance</a></li>
        </ul>
      </nav>
    </header>

    <section class="content">

      <h2>How it works</h2>
      <div class="description">
        Try to scroll or resize the container below, or scroll or resize the browser window, or zoom in and out the page.
      </div>

      <div class="playground">
        <div class="outer-container">
          <input class="observed-element" type="text" placeholder="observed element">
        </div>
        <button class="btn undo-btn" name="undoBtn" title="Push to undo."></button>
        <button class="btn resize-btn" name="resizeBtn" title="Drag to resize."></button>
      </div>

      <h2>Explanation</h2>
      <div class="description">
        There are four <i>IntersectionObserver</i> instances created for every target element, one for each side of the element.
        Their boundaries are spread from the viewport edges to the observed element's edges slightly ovelapping the element.
        Once the element's position change is detected, it starts a <a href="https://www.npmjs.com/package/request-animation-frame-loop">request animation frame loop</a>.
        After the element moves vertically up or down the "top" and "bottom" observers are recreated, 
        if the movement was horizontal the "left" and "right" pair of observers are recreated.
        In case of diagonal movement, all observers are recreated.
      </div>

      <h2>Why four observers?</h2>
      <div class="description">
        It guarantees that movement of an observed element in any direction will be detected, 
        even if it is partly overlapped by its parent scrollable container, making this approach reliable and quirks-free.
        The limitation is when an observed element is fully scrolled out of view.
      </div>
    </section>

    <footer class="footer">
      <nav class="footer-links">
        <a class="footer-link github-link" href="https://github.com/itihon/position-observer">Position observer</a>
        <a class="footer-link npm-link" href="https://www.npmjs.com/package/@itihon/position-observer">Install</a>
      </nav>
      <p class="credit">
        Icons were found on <a href="https://www.svgrepo.com">SVG Repo</a>
      </p>
    </footer>

    <div class="tooltip">
      This is an absolutely positioned tooltip, it has to stick to the observed element.
    </div>
    <div class="observer-bounds observer-top"></div>
    <div class="observer-bounds observer-right"></div>
    <div class="observer-bounds observer-bottom"></div>
    <div class="observer-bounds observer-left"></div>
    <script type="module" src="bundle/how-it-works.js"></script>
  </body>
</html>